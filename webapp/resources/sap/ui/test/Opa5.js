/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./Opa','./OpaPlugin','./PageObjectFactory','sap/ui/base/Object','sap/ui/Device','./launchers/iFrameLauncher','./launchers/componentLauncher','sap/ui/core/routing/HashChanger','./matchers/Matcher','./matchers/AggregationFilled','./matchers/PropertyStrictEquals','./pipelines/MatcherPipeline','./pipelines/ActionPipeline'],function(q,O,a,P,U,D,f,c,H,M,A,b,d,e){"use strict";var $=q,p=new a(f._sLogPrefix),m=new d(),o=new e(),F="OpaFrame";var g=U.extend("sap.ui.test.Opa5",q.extend({},O.prototype,{constructor:function(){O.apply(this,arguments);}}));function s(S,T){this.waitFor({viewName:null,controlType:null,id:null,searchOpenDialogs:false,success:function(){h(S);}});var j=i();j.check=f.hasLaunched;j.timeout=T||80;j.errorMessage="unable to load the IFrame with the url: "+S;return this.waitFor(j);}g.prototype.iStartMyUIComponent=function iStartMyUIComponent(j){var C=false;j=j||{};this.waitFor({viewName:null,controlType:null,id:null,searchOpenDialogs:false,success:function(){var l=q.sap.getModulePath("sap.ui.test.OpaCss",".css");q.sap.includeStyleSheet(l);H.getInstance().setHash(j.hash||"");c.start(j.componentConfig).then(function(){C=true;});}});var k=i();k.errorMessage="Unable to load the component with the name: "+j.name;k.check=function(){return C;};if(j.timeout){k.timeout=j.timeout;}return this.waitFor(k);};g.prototype.iTeardownMyUIComponent=function iTeardownMyUIComponent(){return this.waitFor({success:function(){c.teardown();}});};g.prototype.iTeardownMyApp=function(){var j=i();j.success=function(){if(f.hasLaunched()){this.iTeardownMyAppFrame();}else if(c.hasLaunched()){this.iTeardownMyUIComponent();}else{var E="A teardown was called but there was nothing to tear down use iStartMyComponent or iStartMyAppInAFrame";$.sap.log.error(E,"Opa");throw new Error(E);}}.bind(this);return this.waitFor(j);};g.iStartMyAppInAFrame=s;g.prototype.iStartMyAppInAFrame=s;function t(){return this.waitFor({success:function(){f.teardown();}});}g.iTeardownMyAppFrame=t;g.prototype.iTeardownMyAppFrame=t;g.prototype.waitFor=function(j){var v=j.actions;j=$.extend({},O.config,j);var k=j.check,C=null,l=j.success,r,n;j.check=function(){var u=$.extend({},j,{interactable:!!v}),p=g.getPlugin();n=p._isLookingForAControl(u);if(n){C=p.getMatchingControls(u);}if(typeof j.id==="string"&&!C){return false;}if(!j.id&&(j.viewName||j.searchOpenDialogs)&&C.length===0){q.sap.log.debug("found no controls in view: "+j.viewName+" with controlType "+j.sOriginalControlType,"","Opa");return false;}if(j.id instanceof RegExp&&!C.length){q.sap.log.debug("found no control with the id regex"+j.id);return false;}if($.isArray(j.id)&&(!C||C.length!==j.id.length)){if(C&&C.length){q.sap.log.debug("found not all controls with the ids "+j.id+" onlyFound the controls: "+C.map(function(w){return w.sId;}));}else{q.sap.log.debug("found no control with the id  "+j.id);}return false;}if(j.controlType&&$.isArray(C)&&!C.length){q.sap.log.debug("found no controls with the type  "+j.sOriginalControlType,"","Opa");return false;}if((C||!n)&&j.matchers){r=m.process({matchers:j.matchers,control:C});if(!r){return false;}}else{r=C;}if(k){return this._executeCheck(k,r);}return true;};j.success=function(){if(v&&(r||!n)){o.process({actions:v,control:r});}if(l){var u=[];r&&u.push(r);l.apply(this,u);}};return O.prototype.waitFor.call(this,j);};g.getPlugin=function(){return f.getPlugin()||p;};g.getJQuery=function(){return f.getJQuery();};g.getWindow=function(){return f.getWindow();};g.getUtils=function(){return f.getUtils();};g.getHashChanger=function(){return f.getHashChanger();};g.extendConfig=O.extendConfig;g.resetConfig=function(){O.resetConfig();O.extendConfig({viewNamespace:"",arrangements:new g(),actions:new g(),assertions:new g(),visible:true,_stackDropCount:1});};g.emptyQueue=O.emptyQueue;g.stopQueue=O.stopQueue;g.getContext=O.getContext;g.matchers={};g.matchers.Matcher=M;g.matchers.AggregationFilled=A;g.matchers.PropertyStrictEquals=b;g.createPageObjects=function(j){return P.create(j,g);};g.prototype._executeCheck=function(C,v){var j=[];v&&j.push(v);q.sap.log.debug("Opa is executing the check: "+C);var r=C.apply(this,j);q.sap.log.debug("Opa check was "+r);return r;};g.resetConfig();function h(S){var I=q.sap.getModulePath("sap.ui.test.OpaCss",".css");q.sap.includeStyleSheet(I);return f.launch({frameId:F,source:S});}function i(){return{viewName:null,controlType:null,id:null,searchOpenDialogs:false};}$(function(){if($("#"+F).length){h();}$("body").addClass("sapUiBody");$("html").height("100%");});return g;},true);
