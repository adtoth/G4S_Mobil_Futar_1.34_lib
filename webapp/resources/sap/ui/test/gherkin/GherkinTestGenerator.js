/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/Object','sap/ui/test/gherkin/dataTableUtils','sap/ui/test/gherkin/simpleGherkinParser'],function($,U,d,s){'use strict';var G=U.extend("sap.ui.test.gherkin.GherkinTestGenerator",{constructor:function(f,S,a){U.apply(this,arguments);if($.type(f)==="string"){f=s.parseFile(f);}else if(($.type(f)!=="object")||!f.scenarios){throw new Error("GherkinTestGenerator constructor: parameter 'vFeature' must be a valid String or a valid Feature object");}if(($.type(S)!=="function")||!((new S()).register)){throw new Error("GherkinTestGenerator constructor: parameter 'fnStepDefsConstructor' must be a valid StepDefinitions constructor");}if(a&&$.type(a)!=="function"){throw new Error("GherkinTestGenerator constructor: if specified, parameter 'fnAlternateTestStepGenerator' must be a valid Function");}this._oFeature=f;this._fnStepDefsConstructor=S;this._oStepDefs=null;this._fnAlternateTestStepGenerator=a||null;},setUp:function(){this._oStepDefs=new this._fnStepDefsConstructor();},tearDown:function(){if(this._oStepDefs&&this._oStepDefs._needsTearDown){this._oStepDefs.closeApplication();}this._oStepDefs=null;},generate:function(){if(!this._oStepDefs){this.setUp();}return this._generateFeatureTest();},execute:function(t){if(!this._oStepDefs){throw new Error("Run 'generate' before calling 'execute'");}if(!t||(!t.skip&&(($.type(t.func)!=="function")||($.type(t.parameters)!=="array")))){throw new Error("Input parameter 'oTestStep' is not a valid TestStep object.");}if(!t.skip){t.func.apply(this._oStepDefs,t.parameters);this._oStepDefs._needsTearDown=true;}return(!t.skip);},_generateFeatureTest:function(){var t=this._oFeature.scenarios.map(function(o){return this._generateTestScenario(o,this._oFeature.background);},this);var f=($.inArray('@wip',this._oFeature.tags)!==-1);var a=t.every(function(T){return T.testSteps.every(function(o){return o.skip;});});var S=f||a;return{name:((f)?'(WIP) ':'')+'Feature: '+this._oFeature.name,skip:S,wip:f,testScenarios:t};},_generateTestScenario:function(S,b){var a=this;var w=$.inArray('@wip',S.tags)!==-1;var i=!!S.examples;var c=(i)?"Scenario Outline: ":"Scenario: ";var e=(w?'(WIP) ':'')+c+S.name;var t=[];var f=false;if(b){t=a._generateTestSteps(w,b,false);f=(!t[0].isMatch);}if(i){var E=this._convertScenarioExamplesToListOfObjects(S.examples);E.forEach(function(o){var g=$.extend(true,{},S);$.each(o,function(v,V){g.steps.forEach(function(h){var j=v.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1");h.text=h.text.replace(new RegExp('<'+j+'>','g'),V);});});t=t.concat(a._generateTestSteps(w,g,f));});}else{t=t.concat(a._generateTestSteps(w,S,f));}return{name:e,wip:w,testSteps:t};},_generateTestSteps:function(I,S,b){var t=[];for(var i=0;i<S.steps.length;++i){var o=S.steps[i];var T=this._oStepDefs._generateTestStep(o);if(!T.isMatch&&this._fnAlternateTestStepGenerator){T=this._fnAlternateTestStepGenerator(o);}if(!T.isMatch){b=true;}T.skip=b||I;if(T.isMatch&&T.skip){T.text='(SKIPPED) '+T.text;}t.push(T);}return t;},_convertScenarioExamplesToListOfObjects:function(e){var e=e.map(function(i){return $.type(i)==="string"?[i]:i;});return d.toTable(e);}});return G;},true);
